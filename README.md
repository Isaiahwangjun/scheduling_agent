# AI Email & Scheduling Agent with MCP

ç‚ºå¿™ç¢Œçš„ç¶“ç†é–‹ç™¼çš„ AI Agentï¼Œè‡ªå‹•è™•ç†æ”¶ä»¶åŒ£ä¸¦é€é MCP å”è­°ç®¡ç†æœƒè­°æ’ç¨‹ã€‚

## åŠŸèƒ½ç‰¹è‰²

- **éƒµä»¶åˆ†é¡**ï¼šè‡ªå‹•åˆ†é¡ç‚ºæ€¥ä»¶ã€ä¸€èˆ¬ã€è©¢åƒ¹ã€æœƒè­°é‚€ç´„ã€åƒåœ¾ï¼Œä¸¦çµ¦äºˆ 1-5 å„ªå…ˆç´š
- **MCP Server æ•´åˆ**ï¼šè¡Œäº‹æ›†å°è£ç‚ºæ¨™æº– MCP Serverï¼ŒAgent å‹•æ…‹å–å¾— tools
- **æ™ºæ…§æœƒè­°æ’ç¨‹**ï¼šè‡ªå‹•æª¢æŸ¥è¡çªã€è¾¨è­˜éå·¥ä½œæ—¥ï¼ˆé€±æœ«/åœ‹å®šå‡æ—¥ï¼‰ã€å»ºè­°æ›¿ä»£æ™‚æ®µ
- **æ™‚åºæ¨ç†**ï¼šè™•ç†éƒµä»¶ A åŠ å…¥è¡Œç¨‹å¾Œï¼Œè™•ç†éƒµä»¶ B èƒ½åµæ¸¬ã€Œå‰›ç”¢ç”Ÿçš„è¡çªã€
- **å®‰å…¨è­·æ¬„**ï¼šé˜²æ­¢ Agent æœªç¶“æˆæ¬Šåšå‡ºåˆç´„/é‡‘éŒ¢æ‰¿è«¾

## å¿«é€Ÿé–‹å§‹

### ç’°å¢ƒéœ€æ±‚

- Python >= 3.11
- OpenAI API Keyï¼ˆæˆ–ç›¸å®¹çš„ API endpointï¼‰

### å®‰è£

```bash
# ä½¿ç”¨ uvï¼ˆæ¨è–¦ï¼‰
uv sync

# æˆ–ä½¿ç”¨ pip
pip install -e .
```

### è¨­å®š

è¤‡è£½ `.env.example` ä¸¦å¡«å…¥ API è¨­å®šï¼š

```bash
cp .env.example .env
```

ç·¨è¼¯ `.env`ï¼š
```
OPENAI_API_BASE=https://api.openai.com/v1/
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4o-mini
```

### åŸ·è¡Œ

```bash
# ä½¿ç”¨ uv
uv run run.py

# æˆ–ç›´æ¥åŸ·è¡Œ
python run.py
```

## æ¶æ§‹è¨­è¨ˆ

### LangGraph æµç¨‹

```
                 classify
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
     æœƒè­°é‚€ç´„                  å…¶ä»–
        â”‚                       â”‚
   meeting_agent                â”‚
   (ReAct + MCP)                â”‚
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
             generate_reply
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
   åƒåœ¾/no-reply              å…¶ä»–
        â”‚                       â”‚
        â”‚               check_guardrails
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                finalize
```

### MCP æ•´åˆ

```
mcp_server.py (Calendar MCP Server)
     â†‘
     â”‚ stdio transport
     â”‚
langchain-mcp-adapters
     â”‚
     â””â”€ å‹•æ…‹å–å¾— tools â†’ LangChain Tools â†’ ReAct Agent
```

MCP Server æä¾› 4 å€‹ Toolsï¼š
- `check_working_day` - æª¢æŸ¥æ˜¯å¦ç‚ºå·¥ä½œæ—¥ï¼ˆé€±æœ«/åœ‹å®šå‡æ—¥ï¼‰
- `get_calendar_events` - æŸ¥è©¢è¡Œç¨‹
- `add_calendar_event` - æ–°å¢æœƒè­°
- `delete_calendar_event` - åˆªé™¤è¡Œç¨‹

## å°ˆæ¡ˆçµæ§‹

```
scheduling_agent/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ emails.json          # 13 å°æ¸¬è©¦éƒµä»¶
â”‚   â””â”€â”€ calendar.json        # è¡Œäº‹æ›†
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ results.json         # è™•ç†çµæœ
â”‚   â””â”€â”€ calendar_final.json  # æœ€çµ‚è¡Œäº‹æ›†
â”œâ”€â”€ agent/
â”‚   â”œâ”€â”€ llm.py               # LLM è¨­å®š
â”‚   â”œâ”€â”€ state.py             # AgentState å®šç¾©
â”‚   â”œâ”€â”€ graph.py             # LangGraph æµç¨‹
â”‚   â”œâ”€â”€ mcp_client.py        # MCP Clientï¼ˆä½¿ç”¨ langchain-mcp-adaptersï¼‰
â”‚   â””â”€â”€ nodes/
â”‚       â”œâ”€â”€ classify.py      # åˆ†é¡ç¯€é»
â”‚       â”œâ”€â”€ meeting_agent.py # æœƒè­°è™•ç†ï¼ˆReActï¼‰
â”‚       â”œâ”€â”€ generate_reply.py# ç”Ÿæˆå›è¦†
â”‚       â”œâ”€â”€ check_guardrails.py
â”‚       â””â”€â”€ finalize.py
â”œâ”€â”€ mcp_server.py            # MCP Server
â”œâ”€â”€ run.py                   # ä¸»ç¨‹å¼
â””â”€â”€ pyproject.toml
```

## è¨­è¨ˆæ±ºç­–

### 1. å‡æ—¥åˆ¤æ–·ç”¨ç¡¬ç·¨ç¢¼

é¿å… LLM å¹»è¦ºï¼Œç¢ºä¿é€±æœ«/åœ‹å®šå‡æ—¥åˆ¤æ–·æ­£ç¢ºã€‚å‡æ—¥è¡¨å®šç¾©åœ¨ `mcp_server.py`ï¼š

```python
HOLIDAYS_2026 = {
    date(2026, 2, 16): "é™¤å¤•",
    date(2026, 2, 17): "æ˜¥ç¯€",
    ...
}
```

### 2. MCP å‹•æ…‹å–å¾— Tools

Agent é€£ä¸Š Server å¾Œæ‰å–å¾— tool schemaï¼Œä¸åœ¨ç¨‹å¼ç¢¼å¯«æ­»ã€‚ç¬¦åˆ MCP æ¨™æº–ç”¨æ³•ã€‚

### 3. å…ˆåˆ°å…ˆå¾—çš„è¡çªè™•ç†

é¡Œç›®æ˜ç¢ºè¦æ±‚ã€Œå³ä¾¿æ˜¯é‡è¦é‚€ç´„ä¹Ÿè¦å©‰æ‹’ã€ï¼Œæ•…æ¡ç”¨æ™‚åºå„ªå…ˆè€Œéå„ªå…ˆç´šè¦†è“‹ã€‚

### 4. è­·æ¬„ç¨ç«‹ç¯€é»

ä¸è®“ LLM è‡ªå·±æ±ºå®šæ˜¯å¦è§¸ç™¼è­·æ¬„ï¼Œç”±ç¨ç«‹ç¯€é»æª¢æŸ¥æ•æ„Ÿé—œéµè©ã€‚

### 5. Pydantic Structured Output

ä½¿ç”¨ `create_react_agent` çš„ `response_format` åƒæ•¸ç¢ºä¿è¼¸å‡ºæ ¼å¼ä¸€è‡´ï¼š

```python
agent = create_react_agent(
    llm,
    tools,
    response_format=MeetingResult,
)
```

## æ¸¬è©¦éƒµä»¶é™·é˜±

| ID | é¡å‹ | é™·é˜± |
|----|------|------|
| EM002 | æœƒè­° 1/20 14:00 | èˆ‡ã€ŒAI å·”å³°è«–å£‡ã€è¡çª |
| EM005 | æœƒè­° 1/21 ä¸­åˆ | èˆ‡ã€Œå°ˆæ¡ˆé–‹ç™¼æ™‚æ®µã€è¡çª |
| EM011 | æœƒè­° 2/16 | é™¤å¤•ï¼ˆéå·¥ä½œæ—¥ï¼‰ |
| EM012 | æœƒè­° 1/25 | é€±æ—¥ï¼ˆéå·¥ä½œæ—¥ï¼‰ |
| EM013 | æ”¹æœŸ 1/27â†’1/23 | éœ€åˆªé™¤èˆŠæœƒè­° |

## Production æ“´å±•è€ƒé‡

è‹¥éƒ¨ç½²è‡³ç”Ÿç”¢ç’°å¢ƒï¼Œæœƒé¡å¤–è€ƒæ…®ï¼š

1. **å„ªå…ˆç´šè¡çªè™•ç†**ï¼šé«˜å„ªå…ˆç´šæœƒè­°æ“ æ‰ä½å„ªå…ˆç´šï¼Œéœ€äººå·¥å¯©æ ¸
2. **é€šçŸ¥æ©Ÿåˆ¶**ï¼šè¢«èª¿æ•´çš„æœƒè­°è‡ªå‹•é€šçŸ¥ç›¸é—œäººå“¡
3. **Audit Log**ï¼šè¨˜éŒ„æ‰€æœ‰è¡Œäº‹æ›†æ“ä½œ
4. **é‚€ç´„é¡å‹åˆ¤æ–·**ï¼šå€åˆ†å¯æ”¹æœŸï¼ˆä¸€å°ä¸€æœƒè­°ï¼‰èˆ‡ä¸å¯æ”¹æœŸï¼ˆè«–å£‡/ç ”è¨æœƒï¼‰çš„é‚€ç´„

## æ¨¡æ“¬æ—¥æœŸ

**2026-01-19ï¼ˆé€±ä¸€ï¼‰**

---

## 13 å°éƒµä»¶è™•ç†æµç¨‹æ¼”ç¤º

ä»¥ä¸‹å±•ç¤º Agent è™•ç†æ¯å°éƒµä»¶çš„æ±ºç­–éç¨‹ï¼š

### ä¸€èˆ¬éƒµä»¶è™•ç†

| ID | å¯„ä»¶è€… | åˆ†é¡ | å„ªå…ˆç´š | è™•ç†æ–¹å¼ |
|----|--------|------|--------|----------|
| EM001 | boss@company.com | æ€¥ä»¶ | 5 | è€é—†éƒµä»¶ + ã€Œç·Šæ€¥ã€é—œéµå­— â†’ æœ€é«˜å„ªå…ˆç´šï¼Œç”Ÿæˆå›è¦† |
| EM003 | marketing@spam_service.net | åƒåœ¾ | 1 | è¡ŒéŠ·å»£å‘Šï¼Œä¸å›è¦† |
| EM004 | hr@company.com | ä¸€èˆ¬ | 2 | å…§éƒ¨é€šçŸ¥ï¼Œç”Ÿæˆç°¡çŸ­å›è¦† |
| EM006 | customer_service@bank.com | ä¸€èˆ¬ | 2 | å¸³å–®é€šçŸ¥ï¼Œä¸éœ€å›è¦† |
| EM007 | potential_client@startup.io | è©¢åƒ¹ | 3 | è§¸ç™¼è­·æ¬„ â†’ éœ€äººå·¥å¯©æ ¸ |
| EM008 | newsletter@tech_daily.com | åƒåœ¾ | 1 | Newsletterï¼Œä¸å›è¦† |
| EM009 | no-reply@uber.com | åƒåœ¾ | 1 | æ”¶æ“šï¼Œä¸å›è¦† |
| EM010 | conference@ai_summit.org | ä¸€èˆ¬ | 2 | å ±åç¢ºèªä¿¡ï¼ˆè¡Œäº‹æ›†å·²æœ‰æ­¤æ´»å‹•ï¼‰ |

### æœƒè­°é‚€ç´„è™•ç†ï¼ˆå«æ—¥æœŸé™·é˜±ï¼‰

#### EM002ï¼š1/20 14:00 åˆä½œæ´½è«‡ â†’ æ™‚é–“è¡çª

```
1. è§£æé‚€ç´„ï¼š1/20 14:00-14:30
2. check_working_day("2026-01-20") â†’ is_working: true
3. get_calendar_events("2026-01-20") â†’ ç™¼ç¾ã€ŒAI å·”å³°è«–å£‡ 13:00-17:00ã€
4. åˆ¤æ–·ï¼š14:00 åœ¨ 13:00-17:00 ç¯„åœå…§ â†’ è¡çª
5. æŸ¥è©¢ 1/21 è¡Œç¨‹ï¼Œæ‰¾åˆ°å¯ç”¨æ™‚æ®µ
6. æ±ºç­–ï¼šä¸æ–°å¢ï¼Œå»ºè­°æ”¹æœŸè‡³ 1/21 14:30
```

#### EM005ï¼š1/21 ä¸­åˆèšé¤ â†’ é‚Šç•Œæƒ…æ³

```
1. è§£æé‚€ç´„ï¼š1/21 ä¸­åˆï¼ˆç´„ 12:00-13:00ï¼‰
2. check_working_day("2026-01-21") â†’ is_working: true
3. get_calendar_events("2026-01-21") â†’ ç™¼ç¾ã€Œå°ˆæ¡ˆé–‹ç™¼æ™‚æ®µ 09:00-12:00ã€
4. åˆ¤æ–·ï¼š12:00 å‰›å¥½åœ¨å°ˆæ¡ˆæ™‚æ®µçµæŸæ™‚ â†’ ç„¡è¡çªï¼ˆæˆ–é‚Šç•Œè¡çªï¼Œè¦–å¯¦ä½œï¼‰
5. æ±ºç­–ï¼šæ–°å¢èšé¤ 12:00-13:00
```

#### EM011ï¼š2/16 å°å¸³æœƒè­° â†’ é™¤å¤•é™·é˜± ğŸ¯

```
1. è§£æé‚€ç´„ï¼š2/16 10:00
2. check_working_day("2026-02-16") â†’ is_working: false, reason: "é™¤å¤•"
3. æ±ºç­–ï¼šä¸æ–°å¢æœƒè­°
4. ä½¿ç”¨ suggested_alternatives å»ºè­°æ”¹æœŸè‡³ 2/23, 2/24, 2/25
5. ç”Ÿæˆå©‰æ‹’å›è¦†ï¼Œèªªæ˜é™¤å¤•ç‚ºéå·¥ä½œæ—¥
```

#### EM012ï¼š1/25 ç³»çµ±ç¶­è­·æœƒè­° â†’ é€±æ—¥é™·é˜± ğŸ¯

```
1. è§£æé‚€ç´„ï¼š1/25 14:00
2. check_working_day("2026-01-25") â†’ is_working: false, reason: "é€±æ—¥"
3. æ±ºç­–ï¼šä¸æ–°å¢æœƒè­°
4. ä½¿ç”¨ suggested_alternatives å»ºè­°æ”¹æœŸè‡³ 1/26, 1/27, 1/28
5. ç”Ÿæˆå©‰æ‹’å›è¦†ï¼Œèªªæ˜é€±æ—¥ç‚ºéå·¥ä½œæ—¥
```

#### EM013ï¼šæ”¹æœŸ 1/27 â†’ 1/23 â†’ åˆªé™¤ + æ–°å¢

```
1. è­˜åˆ¥ç‚ºæ”¹æœŸè«‹æ±‚ï¼ˆé—œéµå­—ï¼šã€Œæ”¹åˆ°ã€ï¼‰
2. check_working_day("2026-01-23") â†’ is_working: true
3. get_calendar_events("2026-01-23") â†’ ç„¡è¡çª
4. delete_calendar_event(start="2026-01-27T14:00:00") â†’ åˆªé™¤èˆŠæœƒè­°
5. add_calendar_event("è¦–è¨Šæœƒè­°", "2026-01-23T14:00:00", "2026-01-23T16:00:00")
6. æ±ºç­–ï¼šå®Œæˆæ”¹æœŸ
```

---

## é™¤å¤•èˆ‡é€±æœ«çš„æ¨ç†åˆ¤æ–·é‚è¼¯

### è¨­è¨ˆåŸå‰‡ï¼šä¸ä¾è³´ LLM åˆ¤æ–·æ—¥æœŸ

LLM å°æ–¼ã€Œ2026 å¹´é™¤å¤•æ˜¯å“ªä¸€å¤©ã€é€™é¡å•é¡Œå®¹æ˜“ç”¢ç”Ÿå¹»è¦ºã€‚å› æ­¤æ¡ç”¨**ç¡¬ç·¨ç¢¼ + Tool å¼·åˆ¶å‘¼å«**çš„æ–¹å¼ï¼š

### å¯¦ä½œæ–¹å¼

```python
# mcp_server.py - ç¡¬ç·¨ç¢¼ 2026 å¹´å°ç£å‡æ—¥
HOLIDAYS_2026 = {
    date(2026, 1, 1): "å…ƒæ—¦",
    date(2026, 2, 16): "é™¤å¤•",      # é—œéµï¼
    date(2026, 2, 17): "æ˜¥ç¯€",
    date(2026, 2, 18): "æ˜¥ç¯€",
    # ...
}

def _is_working_day(d: date) -> tuple[bool, str | None]:
    # é€±æœ«åˆ¤æ–·
    if d.weekday() == 5:
        return False, "é€±å…­"
    if d.weekday() == 6:
        return False, "é€±æ—¥"
    # å‡æ—¥åˆ¤æ–·
    if d in HOLIDAYS_2026:
        return False, HOLIDAYS_2026[d]
    return True, None
```

### Tool Description å¼·åˆ¶å‘¼å«

é€é Tool Description å¼•å° LLM å¿…é ˆå…ˆæª¢æŸ¥æ—¥æœŸï¼š

```python
@mcp.tool()
def check_working_day(date_str: str) -> dict:
    """æª¢æŸ¥æ—¥æœŸæ˜¯å¦ç‚ºå·¥ä½œæ—¥ï¼ˆæ’é™¤é€±æœ«å’Œåœ‹å®šå‡æ—¥ï¼‰ã€‚

    âš ï¸ è™•ç†æœƒè­°é‚€ç´„æ™‚ï¼Œå¿…é ˆé¦–å…ˆå‘¼å«æ­¤å·¥å…·ï¼

    é‡è¦è¦å‰‡ï¼š
    - è‹¥å›å‚³ is_working=falseï¼Œçµ•å°ä¸å¯åœ¨è©²æ—¥å®‰æ’æœƒè­°
    - å¿…é ˆä½¿ç”¨ suggested_alternatives ä¸­çš„æ—¥æœŸä½œç‚ºæ›¿ä»£æ–¹æ¡ˆ
    """
```

### ç‚ºä»€éº¼ä¸ç”¨ LLM åˆ¤æ–·ï¼Ÿ

| æ–¹å¼ | å„ªé» | ç¼ºé» |
|------|------|------|
| LLM åˆ¤æ–· | å½ˆæ€§é«˜ | 2026 é™¤å¤•å¯èƒ½åˆ¤æ–·éŒ¯èª¤ |
| ç¡¬ç·¨ç¢¼ | 100% æº–ç¢º | éœ€ç¶­è­·å‡æ—¥è¡¨ |
| å‘¼å«å¤–éƒ¨ API | å³æ™‚æº–ç¢º | å¢åŠ ä¾è³´ |

æœ¬å°ˆæ¡ˆé¸æ“‡**ç¡¬ç·¨ç¢¼**ï¼Œç¢ºä¿é—œéµæ¥­å‹™é‚è¼¯çš„æ­£ç¢ºæ€§ã€‚

---

## é¿å…æ¨¡å‹å¹»è¦ºçš„è¨­è¨ˆ

### 1. çµæ§‹åŒ–è¼¸å‡ºï¼ˆPydanticï¼‰

å¼·åˆ¶ LLM è¼¸å‡ºç¬¦åˆ schema çš„çµæ§‹ï¼Œé¿å…æ ¼å¼éŒ¯èª¤ï¼š

```python
class MeetingResult(BaseModel):
    date: str = Field(description="æœƒè­°æ—¥æœŸ YYYY-MM-DD")
    is_working_day: bool  # å¿…é ˆå¡«å…¥ï¼Œä¸èƒ½çœç•¥
    added: bool
    reason: str
```

### 2. Tool Description å³æŒ‡ä»¤

ä¸åœ¨ System Prompt å¯«æ­» tool åç¨±ï¼Œè€Œæ˜¯è®“ tool description è‡ªå¸¶ä½¿ç”¨èªªæ˜ï¼š

```python
# MCP Server tool
def add_calendar_event(...):
    """
    æ–°å¢è¡Œäº‹æ›†äº‹ä»¶ã€‚å‘¼å«å‰è«‹ç¢ºä¿ï¼š
    1. å·²ç”¨ check_working_day ç¢ºèªè©²æ—¥ç‚ºå·¥ä½œæ—¥
    2. å·²ç”¨ get_calendar_events ç¢ºèªç„¡æ™‚é–“è¡çª
    """
```

é€™æ¨£å³ä½¿æ›´æ› MCP Serverï¼Œåªè¦ description å¯«å¾—å¥½ï¼ŒAgent å°±èƒ½æ­£ç¢ºä½¿ç”¨ã€‚

### 3. è­·æ¬„ç¨ç«‹æ–¼ LLM

ä¸è®“ LLM è‡ªå·±æ±ºå®šæ˜¯å¦è§¸ç™¼è­·æ¬„ï¼Œæ”¹ç”¨è¦å‰‡å¼•æ“ï¼š

```python
# agent/nodes/check_guardrails.py
SENSITIVE_KEYWORDS = ["å ±åƒ¹", "åƒ¹æ ¼", "åˆç´„", "ç°½ç´„", "ä»˜æ¬¾"]

def check_guardrails(state):
    # è¦å‰‡ 1: è©¢åƒ¹éƒµä»¶ä¸€å¾‹éœ€äººå·¥å¯©æ ¸
    if category == "è©¢åƒ¹":
        return triggered=True

    # è¦å‰‡ 2: å›è¦†åŒ…å«æ•æ„Ÿè©
    for keyword in SENSITIVE_KEYWORDS:
        if keyword in reply:
            return triggered=True
```

### 4. é—œéµè³‡è¨Šç¡¬ç·¨ç¢¼

- å‡æ—¥è¡¨ï¼š`mcp_server.py`
- ä»Šæ—¥æ—¥æœŸï¼š`run.py` ä¸­è¨­å®š `TODAY = "2026-01-19"`
- æ•æ„Ÿé—œéµè©ï¼š`check_guardrails.py`

é€™äº›éƒ½ä¸ç¶“é LLMï¼Œç¢ºä¿è¡Œç‚ºå¯é æ¸¬ã€‚

---

## æ™‚åºæ¨ç†ï¼šè™•ç†å‹•æ…‹è¡çª

é¡Œç›®è¦æ±‚ï¼šè™•ç†éƒµä»¶ A å¾Œï¼Œå†è™•ç†éƒµä»¶ B æ™‚èƒ½åµæ¸¬ã€Œå‰›ç”¢ç”Ÿçš„è¡çªã€ã€‚

### å¯¦ä½œæ–¹å¼

1. **MCP Server æ˜¯ stateful** â€” `calendar.json` åœ¨è™•ç†éç¨‹ä¸­å³æ™‚æ›´æ–°
2. **æ¯æ¬¡è™•ç†éƒ½é‡æ–°æŸ¥è©¢** â€” `get_calendar_events` æœƒè®€å–æœ€æ–°çš„ `calendar.json`
3. **å…ˆåˆ°å…ˆå¾—** â€” å…ˆè™•ç†çš„éƒµä»¶å„ªå…ˆï¼Œå¾Œä¾†çš„è‹¥è¡çªå‰‡å©‰æ‹’

```
è™•ç† EM002 â†’ æ–°å¢ 1/21 14:30 æœƒè­° â†’ calendar.json æ›´æ–°
     â†“
è™•ç† EM005 â†’ æŸ¥è©¢ 1/21 è¡Œç¨‹ â†’ çœ‹åˆ°å‰›åŠ çš„æœƒè­° â†’ åˆ¤æ–·è¡çª
```

é€™ç¢ºä¿äº† Agent çš„æ±ºç­–æ˜¯åŸºæ–¼ã€Œç•¶ä¸‹çš„è¡Œäº‹æ›†ç‹€æ…‹ã€ï¼Œè€Œééœæ…‹çš„åˆå§‹ç‹€æ…‹ã€‚

---

## Prompt èˆ‡ Tool Description è¨­è¨ˆ

### è¨­è¨ˆç†å¿µ

æœ¬å°ˆæ¡ˆæ¡ç”¨ **Tool Description å³æŒ‡ä»¤** çš„è¨­è¨ˆæ¨¡å¼ï¼Œè€Œéåœ¨ System Prompt ä¸­å¯«æ­»å·¥å…·åç¨±å’Œä½¿ç”¨é †åºã€‚é€™ç¬¦åˆ MCP å”è­°çš„ç²¾ç¥ï¼šAgent äº‹å…ˆä¸çŸ¥é“æœ‰å“ªäº› toolsï¼Œè€Œæ˜¯å¾ Server å‹•æ…‹å–å¾—ã€‚

### Tool Description æœ€ä½³å¯¦è¸

æ ¹æ“š [Anthropic Tool Use Best Practices](https://docs.anthropic.com/en/docs/build-with-claude/tool-use) å’Œ [LangChain Tool Guidelines](https://docs.langchain.com/oss/python/langchain/tools)ï¼Œè‰¯å¥½çš„ Tool Description æ‡‰åŒ…å«ï¼š

| è¦ç´  | èªªæ˜ | ç¯„ä¾‹ |
|------|------|------|
| **åŠŸèƒ½èªªæ˜** | ä¸€å¥è©±æè¿°å·¥å…·ç”¨é€” | "æª¢æŸ¥æ—¥æœŸæ˜¯å¦ç‚ºå·¥ä½œæ—¥" |
| **ä½¿ç”¨æ™‚æ©Ÿ** | ä½•æ™‚è©²å‘¼å«æ­¤å·¥å…· | "è™•ç†æœƒè­°é‚€ç´„æ™‚ï¼Œå¿…é ˆé¦–å…ˆå‘¼å«" |
| **å‰ç½®æ¢ä»¶** | å‘¼å«å‰éœ€å®Œæˆä»€éº¼ | "å‘¼å«å‰é ˆå…ˆç”¨ check_working_day ç¢ºèª" |
| **åƒæ•¸èªªæ˜** | æ¯å€‹åƒæ•¸çš„ç”¨é€”å’Œæ ¼å¼ | "date_str: æ—¥æœŸï¼Œæ ¼å¼ç‚º YYYY-MM-DD" |
| **å›å‚³èªªæ˜** | å›å‚³å€¼çš„çµæ§‹å’Œæ„ç¾© | "is_working=false è¡¨ç¤ºéå·¥ä½œæ—¥" |

### æœ¬å°ˆæ¡ˆçš„ Tool Description ç¯„ä¾‹

```python
@mcp.tool()
def check_working_day(date_str: str) -> dict:
    """æª¢æŸ¥æ—¥æœŸæ˜¯å¦ç‚ºå·¥ä½œæ—¥ï¼ˆæ’é™¤é€±æœ«å’Œåœ‹å®šå‡æ—¥ï¼‰ã€‚

    âš ï¸ è™•ç†æœƒè­°é‚€ç´„æ™‚ï¼Œå¿…é ˆé¦–å…ˆå‘¼å«æ­¤å·¥å…·ï¼

    ä½¿ç”¨æ™‚æ©Ÿï¼š
    - æ”¶åˆ°æœƒè­°é‚€ç´„æ™‚ï¼Œå…ˆæª¢æŸ¥é‚€ç´„æ—¥æœŸæ˜¯å¦ç‚ºå·¥ä½œæ—¥
    - åœ¨å‘¼å« add_calendar_event ä¹‹å‰ï¼Œå‹™å¿…å…ˆç¢ºèªæ—¥æœŸ

    é‡è¦è¦å‰‡ï¼š
    - è‹¥ is_working=falseï¼Œçµ•å°ä¸å¯åœ¨è©²æ—¥å®‰æ’æœƒè­°
    - éå·¥ä½œæ—¥åŒ…æ‹¬ï¼šé€±å…­ã€é€±æ—¥ã€åœ‹å®šå‡æ—¥ï¼ˆé™¤å¤•ã€æ˜¥ç¯€ã€æ¸…æ˜ç­‰ï¼‰
    - è‹¥ç‚ºéå·¥ä½œæ—¥ï¼Œä½¿ç”¨ suggested_alternatives å»ºè­°æ›¿ä»£æ—¥æœŸ

    Args:
        date_str: æ—¥æœŸï¼Œæ ¼å¼ç‚º YYYY-MM-DDï¼ˆå¦‚ 2026-01-20ï¼‰

    Returns:
        - date: æŸ¥è©¢çš„æ—¥æœŸ
        - is_working: true/false
        - reason: è‹¥ç‚ºéå·¥ä½œæ—¥ï¼Œèªªæ˜åŸå› 
        - suggested_alternatives: è‹¥ç‚ºéå·¥ä½œæ—¥ï¼Œæä¾›æ›¿ä»£å·¥ä½œæ—¥
    """
```

### ç‚ºä»€éº¼ä¸åœ¨ System Prompt å¯«æ­»å·¥å…·é †åºï¼Ÿ

| æ–¹å¼ | å„ªé» | ç¼ºé» |
|------|------|------|
| System Prompt å¯«æ­» | åŸ·è¡Œé †åºå¯æ§ | æ› MCP Server å°±å¤±æ•ˆ |
| Tool Description å¼•å° | ç¬¦åˆ MCP ç²¾ç¥ï¼Œå¯ç§»æ¤ | ä¾è³´ LLM ç†è§£èƒ½åŠ› |

æœ¬å°ˆæ¡ˆé¸æ“‡å¾Œè€…ï¼Œé€éè‰¯å¥½çš„ Tool Description å¼•å° LLM æ­£ç¢ºä½¿ç”¨å·¥å…·ã€‚

### System Prompt è¨­è¨ˆ

System Prompt åªæè¿°ä»»å‹™ç›®æ¨™å’ŒåŸå‰‡ï¼Œä¸å¯«æ­»å·¥å…·åç¨±ï¼š

```python
SYSTEM_PROMPT = """ä½ æ˜¯æœƒè­°æ’ç¨‹åŠ©ç†ã€‚ä»Šå¤©æ˜¯ {today}ã€‚

è™•ç†æœƒè­°é‚€ç´„çš„åŸå‰‡ï¼š
1. ç¢ºèªæ—¥æœŸæ˜¯å¦ç‚ºå·¥ä½œæ—¥ï¼ˆé€±æœ«å’Œåœ‹å®šå‡æ—¥ä¸å¯å®‰æ’æœƒè­°ï¼‰
2. ç¢ºèªæ™‚æ®µæ˜¯å¦æœ‰è¡çª
3. å…©è€…çš†é€šéæ‰èƒ½æ–°å¢æœƒè­°ï¼›å¦å‰‡å»ºè­° 2-3 å€‹æ›¿ä»£æ™‚æ®µ
4. æ”¹æœŸè«‹æ±‚éœ€å…ˆç§»é™¤èˆŠæœƒè­°å†æ–°å¢æ–°æœƒè­°

è«‹å–„ç”¨å¯ç”¨çš„å·¥å…·ä¾†å®Œæˆä»»å‹™ã€‚
"""
```

---

## åƒè€ƒè³‡æ–™

### MCP (Model Context Protocol)

- [MCP å®˜æ–¹æ–‡æª”](https://modelcontextprotocol.io/)
- [FastMCP Python SDK](https://github.com/jlowin/fastmcp)
- [LangChain MCP Adapters](https://github.com/langchain-ai/langchain-mcp-adapters)

### Tool Use & Prompt Engineering

- [Anthropic Tool Use Best Practices](https://docs.anthropic.com/en/docs/build-with-claude/tool-use)
- [LangChain Tools Documentation](https://docs.langchain.com/oss/python/langchain/tools)
- [LangChain Agent Guidelines](https://docs.langchain.com/oss/python/langchain/agents)

### LangGraph

- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [LangGraph ReAct Agent](https://langchain-ai.github.io/langgraph/tutorials/introduction/)
